import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup, KeyboardButton
import sqlite3
import random
import json
from datetime import datetime



# Replace with your actual bot token
BOT_TOKEN = "8255745574:AAFGYMFVIprimoIu0zf_YiabAUd8imyhNDM"

bot = telebot.TeleBot(BOT_TOKEN)

# Database setup
conn = sqlite3.connect('poetry_bot.db', check_same_thread=False)
cursor = conn.cursor()

# Create tables if not exist
cursor.execute('''
CREATE TABLE IF NOT EXISTS Users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT,
    phone TEXT,
    joined_date TEXT
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS Poems (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    text TEXT,
    weight_text TEXT,
    weight_pattern TEXT,
    options TEXT,  -- JSON string
    correct_answer INTEGER
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS Scores (
    user_id INTEGER,
    correct INTEGER DEFAULT 0,
    wrong INTEGER DEFAULT 0,
    total INTEGER DEFAULT 0,
    FOREIGN KEY(user_id) REFERENCES Users(id)
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS VoiceExercises (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    file_id TEXT,
    weight_text TEXT,
    options TEXT,  -- JSON string
    correct_answer INTEGER
)
''')

conn.commit()

# Sample data insertion (run once or as needed)
def insert_sample_data():
    poems = [
        # فردوسی (13 بیت کامل)
        {
            "text": "به نام خداوند جان و خرد / کزین برتر اندیشه برنگذرد",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعولن", "فعولن فعولن فعولن فعل", "فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 1
        },
        {
            "text": "بسی رنج بردم در این سال سی / عجم زنده کردم بدین پارسی",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 2
        },
        {
            "text": "دریغ است ایران که ویران شود / کنام پلنگان و شیران شود",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعل", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "توانا بود هر که دانا بود / ز دانش دل پیر برنا بود",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "چو ایران نباشد تن من مباد / بدین بوم و بر زنده یک تن مباد",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "فروزنده شمع و چراغی ز بخت / که ایران زمین را به داد آورد",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "یکی داستانی پر از آب چشم / دلی پر ز درد و سوزی چو ریش",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "به گیتی به از راستی پیشه نیست / ز گفتار دروغی پرهیز کن",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "ز داد و دهش یافت این نیکویی / تو داد و دهش کن به هر کس که روی",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "به یزدان اگر ما خرد داشتیم / کجا این سرانجام بد داشتیم",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "به رستم چنین گفت موبد که شاه / نباید که باشد به دل کینه خواه",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "ز داد و دهش دل به دلبر مبند / که دلبر نخواهد به داد و دهش",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "گر ایران پر از دشمنان بادا / به مرگ اندر آویختن بادا",
            "weight_text": "فعولن فعولن فعولن فعل",
            "weight_pattern": "U – – / U – – / U – – / U –",
            "options": json.dumps(["فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        # سعدی (13 بیت کامل)
        {
            "text": "بنی آدم اعضای یکدیگرند / که در آفرینش ز یک گوهرند",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "چو عضوى به درد آورد روزگار / دگر عضوها را نماند قرار",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "تو کز محنت دیگران بی غمی / نشاید که نامت نهند آدمی",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "هر که نامی شد از آن بی نام شد / نامجویان نام خود گم کرده اند",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "ای سرو خوش بالای من ای دلبر رعنای من / لعلین دهن ده جام می پرکن ز مینای من",
            "weight_text": "مستفعلن مستفعلن مستفعلن مستفعلن",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U –",
            "options": json.dumps(["مستفعلن مستفعلن مستفعلن مستفعلن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        {
            "text": "با جوانی سر خوش است این پیر بی تدبیر را / عمر در باد رفت و هم کیش و هم تقدیر را",
            "weight_text": "فاعلاتن فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "ای یار ناسامان من از من چرا رنجیده ای / وی درد و ای درمان من از من چرا رنجیده ای",
            "weight_text": "مستفعلن مستفعلن مستفعلن مستفعلن",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U –",
            "options": json.dumps(["مستفعلن مستفعلن مستفعلن مستفعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "یکی را به دستوری دهی مال / یکی را به پنداری دهی حال",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "به خاک سیاه اندر نشاند کسی / به افلاک برد دیگری را بسی",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عجب نیست گر زاهد به دنیا رسد زهد / عجب آن که دنیادار ز دنیا رسد زهد",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "کسی را که دل زنده باشد به دانش / سخن زنده گرداندش دل به دانش",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "به گفتار پیغمبران فرمود / که دل زنده شد زانکه با مرده بود",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "همه عمر در کوی و بازار بود / به بازار حق را خریدار بود",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        # حافظ (13 بیت کامل)
        {
            "text": "الا یا ایها الساقی ادر کاسا و ناولها / که عشق آسان نمود اول ولی افتاد مشکل ها",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        {
            "text": "به بوی نافه ای کاخر صبا زان طره بگشاید / ز تاب جعد مشکینش چه خون افتاد در دل ها",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "اگر آن ترک شیرازی به دست آرد دل ما را / به خال هندویش بخشم سمرقند و بخارا را",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "بده ساقی می باقی که در جنت نخواهی یافت / کنار آب رکن آباد و گلگشت مصلا را",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "فغانی کزین شهر آن مایه دوش / فلک را به فریاد می باید آورد",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "مرا در منزل جانان چه امن عیش چون هر دم / جرس فریاد می دارد که بربندید محمل ها",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "با دل سنگینت آیا هیچ درگیرد شبیخون / تیر آه آتشناک از کمان ابروانت",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        {
            "text": "زان یار دلنوازم شکری است با شکایت / گر نکته دان عشقی بشنو تو این حکایت",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "بی خبران که طعنه به ما می زنند دایم / دریاب کاین ندیم و همان مونس و همدم ها",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "دوش از مسجد سوی میخانه آمد پیر ما / چیست یاران طریقت بعد از این تدبیر ما",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "ما نه رندان ریاییم و حریفان ملامت / جام را باده نابست و لیکن بوی مستی",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "حافظ از جور چرخ و گردش ایام / دل شکسته ست چون جام جمشید",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "دوش دیدم که ملایک در میخانه زدند / گل آدم بسرشتند و به پیمانه زدند",
            "weight_text": "فعلاتن فعلاتن فعلاتن فعلن",
            "weight_pattern": "– U – – / – U – – / – U – – / U –",
            "options": json.dumps(["فعلاتن فعلاتن فعلاتن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        # مولوی (13 بیت کامل)
        {
            "text": "بشنو از نی چون حکایت می کند / از جدایی ها شکایت می کند",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "کز نیستان تا مرا ببریده اند / از نفیرم مرد و زن نالیده اند",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "هر کسی کو دور ماند از اصل خویش / باز جوید روزگار وصل خویش",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "از جوالدوز و سوزن ها شنیدم / داستان عشق دردی آشنا بود",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "بیا کز شمع و شاهد باز گویم / که دوشین تا سحرگه داستان بود",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "این نی حدیث راه پر خون می کند / قصه های عشق مجنون می کند",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "مهجوری دلم از پرده غیب / کس ندارد آگهی جز ذات پاک",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "سینه خواهم شرحه شرحه از فراق / تا بگویم شرح درد اشتیاق",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "هر که او آگاه شد همدرد گشت / بارها با جان من همدرد گشت",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "جز که محرم درد خود کی یابد او / چون که بی همدرد ماند می میرد او",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "آفتاب آمد دلیل آفتاب / گر دلیلت باید از وی روی متاب",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "از خدا جوییم توفیق ادب / بی ادب محروم ماند از لطف رب",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "بی ادب تنها نه خود را داشت بد / بلکه آتش زد به هر کس خاست بد",
            "weight_text": "مفاعیلن مفاعیلن فعولن",
            "weight_pattern": "U – – / U – – / U – –",
            "options": json.dumps(["مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        # عبید زاکانی (13 بیت کامل)
        {
            "text": "بکشت غمزه آن شوخ بی گناه مرا / ز حد گذشت جدایی ز حد گذشت جفا",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        {
            "text": "به هر کس دل مبند ای دل که در عالم بسی دل هست / به دل داری طمع کاین بی وفایان با وفا دل هست",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "مرا دلبر چو دلبر نیست دلبر / مرا یار چو آن یار نیست یار",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "دلبرا دلبر من دلبر توست / یارا یار من یار توست",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "از آن رو کز تو دلبر دلبرست / از آن رو کز تو یار یارست",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "گر از دلبر دلم دلبر شود / گر از یارم دلم یار شود",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "به دلبر دل دهم دلبر شوم / به یار یار دهم یار شوم",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "دلبرم دلبر دلبر دلبر است / یارم یار یار یار یار است",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "از دل دلبر به دلبر دل رسید / از یار یار به یار یار رسید",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "دل به دلبر دادم و دلبر شدم / یار به یار دادم و یار شدم",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در دل دلبر دل دلبر نهان / در یار یار یار یار نهان",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فعولن فعولن فعولن فعل", "مفاعیلن فعولن مفاعیلن فعولن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "دلبر دلبر است و دل دلبر است / یار یار است و یار یار است",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "به دلبر دل سپردم دلبر گشت / به یار یار سپردم یار گشت",
            "weight_text": "مفاعلن فعلاتن مفاعلن فعلن",
            "weight_pattern": "– – U – / – U – – / – – U – / U –",
            "options": json.dumps(["مفاعلن فعلاتن مفاعلن فعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        # جامی (13 بیت کامل)
        {
            "text": "هر که را عشق مجازی رهنمون / شد به عشق حق رسد بی شک زبون",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "عشق مجنون بود لیلی را نمود / لیلی اش عشق خدا بود و بود",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "هر که را عشق مجازی رهنمون / شد به عشق حق رسد بی شک زبون",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در مقام عشق دلبر دل ربود / دل به دلبر داد و دلبر دل ربود",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "جامی از جام جمشید جام نوش / جام عشق است که جام جم نوش",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در طریق عشق دلبر دل ستان / دل به دلبر داد و دلبر دل ستان",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عاشقان را عشق دلبر دل ربود / عاشقان را عشق دلبر دل ربود",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "جامی از جام عشق نوشیده است / جام عشق از جام دل نوشیده است",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در دل دلبر دل دلبر نهفته / در دل عاشق دل عاشق نهفته",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عشق دلبر دل به دلبر سپرد / عشق عاشق دل به عاشق سپرد",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "جامی جام عشق نوشید و مست / جام عشق از دل دلبر مست",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در طریق عشق دلبر دل کش / دل به دلبر داد و دلبر دل کش",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فاعلاتن فاعلاتن فاعلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عاشق دلبر شد و دلبر عاشق / عاشق عاشق شد و عاشق دلبر",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        # عطار نیشابوری (13 بیت کامل)
        {
            "text": "چون نیست هیچ مردی در عشق یار ما را / جز عشق یار ما را هیچ یار ما را",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "ز زلفت زنده می دارد صبا انفاس عیسی را / به قربانت که قربان است قربان قربانی را",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عطار از عشق تو دیوانه شد دیوانه / دیوانه عشق تو دیوانه شد دیوانه",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در عشق تو عطار عطار شد عطار / عطار عشق تو عطار شد عطار",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "از عشق تو دیوانه دیوانه دیوانه / دیوانه از عشق تو دیوانه دیوانه",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عطار در عشق تو عطار عطار / عطار در عشق تو عطار عطار",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "از تو عشق آمد و عشق آمد از تو / عشق از تو آمد و عشق آمد از تو",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "عطار عطار شد از عشق یار / عطار عطار شد از عشق یار",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در دل دلبر دل دلبر دلبر / در دل عاشق دل عاشق عاشق",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عشق یار یار شد یار عشق / عشق عشق عشق شد عشق عشق",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "عطار از عشق دیوانه گشت / دیوانه از عشق عطار گشت",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در طریق عشق عطار عطار / عطار در طریق عشق عطار",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن فعولن فعولن فعل", "مفعول مفاعیل مفاعیل فعل"]),
            "correct_answer": 0
        },
        {
            "text": "عشق عشق است و عشق عشق است / عشق از عشق آمد و عشق رفت",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "weight_pattern": "– U – – / – U – – / – U –",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        # خیام (13 بیت کامل)
        {
            "text": "گر می نخوری طعنه مزن مستان را / بنیاد مکن تو حیله و دستان را",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        {
            "text": "تو وقف شراب کن می پرستان را / این آب و غذا مگذار در دستان را",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "برخیز بتا بیا ز بهر دل ما / حل کن به می غم دل این مشکل ما",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "می نوش که عمر جاودانی این است / خود حاصلت ز عمر جوانی این است",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "هنگام صبوح ای صنم فرخ پی / پر کن قدح باده و بر دست نه",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "کاین آب روان عجل چو عمر گذشت / دیگر نتوان یافت باز این رفته را",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "این چرخ فلک عجل مرا بکشت / ظلم و جفایش دائم مرا بکشت",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعولن فعولن فعولن فعل"]),
            "correct_answer": 0
        },
        {
            "text": "از دیده دو دیده دائما بکشت / از غیرت غیرت غیر را بکشت",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن مفاعیلن مفاعیلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "این کوزه چو من عاشق زاری بود / در بند سر زلف نگاری بود",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "مفاعیلن فعولن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "مستفعلن مستفعلن مستفعلن مستفعلن"]),
            "correct_answer": 0
        },
        {
            "text": "این دسته که بر گردن او می بینی / مانند کمر بند عیاری بود",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "مفعول فاعلات مفاعیل فاعلن"]),
            "correct_answer": 0
        },
        {
            "text": "در دایره ای کآمدن و رفتن ما / او را نه بدایت نه نهایت پیداست",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "مفاعیلن مفاعیلن فعولن", "فاعلاتن فاعلاتن فاعلن", "فعلاتن فعلاتن فعلاتن فعلن"]),
            "correct_answer": 0
        },
        {
            "text": "کس می ندهد در این معامله راست / کاین آمدن از کجا و رفتن ما",
            "weight_text": "مفعول مفاعیل مفاعیل فعل",
            "weight_pattern": "– – U – / – – U – / – – U – / – – U",
            "options": json.dumps(["مفعول مفاعیل مفاعیل فعل", "فاعلاتن فاعلاتن فاعلاتن فاعلن", "مفاعیلن فعولن مفاعیلن فعولن", "مفتعلن مفتعلن فاعلن"]),
            "correct_answer": 0
        },
        # ادامه ۱۵ تا از ...
        # بیت‌های بیشتر اضافه کن تا به ۱۰۰ برسه (از نتایج وب قبلی استخراج کن)
    ]
    
    for poem in poems:
        cursor.execute('''
        INSERT OR IGNORE INTO Poems (text, weight_text, weight_pattern, options, correct_answer)
        VALUES (?, ?, ?, ?, ?)
        ''', (poem["text"], poem["weight_text"], poem["weight_pattern"], poem["options"], poem["correct_answer"]))
    
    conn.commit()
    
    # for poem in poems:
    #     cursor.execute('''
    #     INSERT OR IGNORE INTO Poems (text, weight_text, weight_pattern, options, correct_answer)
    #     VALUES (?, ?, ?, ?, ?)
    #     ''', (poem["text"], poem["weight_text"], poem["weight_pattern"], poem["options"], poem["correct_answer"]))
    
    # Sample Voice Exercises
    voices = [
        {
            "file_id": "CQACAgQAAxkBAAMyaQ3nCozx-hByu_5Rb46yNGV8E1MAAm8YAALYgHFQiI09LQ4S4TM2BA",
            "weight_text": "فاعلاتن فاعلاتن فاعلن",
            "options": json.dumps(["فاعلاتن فاعلاتن فاعلن", "مفاعیلن مفاعیلن فعولن", "فعولن مفاعیلن فعولن", "فاعلاتن مفاعیلن فعولن"]),
            "correct_answer": 0
        },
        # Add more...
    ]
    
    for voice in voices:
        cursor.execute('''
        INSERT OR IGNORE INTO VoiceExercises (file_id, weight_text, options, correct_answer)
        VALUES (?, ?, ?, ?)
        ''', (voice["file_id"], voice["weight_text"], voice["options"], voice["correct_answer"]))
    
    conn.commit()

# Call to insert sample data (comment out after first run)
# insert_sample_data()

# Helper functions
def get_main_menu():
    markup = ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(KeyboardButton("🔹 درخواست بیت"))
    markup.add(KeyboardButton("🎧 تمرین صوتی وزن"))
    markup.add(KeyboardButton("🆘 پشتیبانی"))
    markup.add(KeyboardButton("👤 حساب من"))  # Optional
    return markup

def register_user(msg):
    user_id = msg.from_user.id
    username = msg.from_user.username
    phone = msg.contact.phone_number if msg.contact else None
    joined_date = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    cursor.execute('SELECT * FROM Users WHERE username = ?', (username,))
    if not cursor.fetchone():
        cursor.execute('''
        INSERT INTO Users (username, phone, joined_date)
        VALUES (?, ?, ?)
        ''', (username, phone, joined_date))
        conn.commit()
        
        cursor.execute('SELECT id FROM Users WHERE username = ?', (username,))
        user_db_id = cursor.fetchone()[0]
        
        cursor.execute('''
        INSERT INTO Scores (user_id)
        VALUES (?)
        ''', (user_db_id,))
        conn.commit()
    
    bot.send_message(msg.chat.id, "ثبت‌نام شما انجام شد! حالا می‌تونید از ربات استفاده کنید.", reply_markup=get_main_menu())

@bot.message_handler(commands=['start'])
def start(msg):
    markup = ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    markup.add(KeyboardButton("ارسال شماره تلفن", request_contact=True))
    bot.send_message(msg.chat.id, "سلام! برای ثبت‌نام، لطفاً شماره تلفن خود را ارسال کنید.", reply_markup=markup)

@bot.message_handler(content_types=['contact'])
def handle_contact(msg):
    register_user(msg)

@bot.message_handler(func=lambda m: m.text == "🔹 درخواست بیت")
def send_poem_quiz(msg):
    cursor.execute('SELECT * FROM Poems ORDER BY RANDOM() LIMIT 1')
    poem = cursor.fetchone()
    if poem:
        poem_id, text, weight_text, weight_pattern, options_json, correct_idx = poem
        options = json.loads(options_json)
        
        markup = InlineKeyboardMarkup()
        for i, opt in enumerate(options):
            callback_data = f"poem_answer:{i}:{correct_idx}:{msg.from_user.id}"
            markup.add(InlineKeyboardButton(opt, callback_data=callback_data))
        
        bot.send_message(msg.chat.id, text, reply_markup=markup)
    else:
        bot.send_message(msg.chat.id, "هیچ بیتی در دیتابیس موجود نیست!")

@bot.callback_query_handler(func=lambda call: call.data.startswith("poem_answer"))
def check_poem_answer(call):
    _, user_choice, correct_idx, user_tg_id = call.data.split(":")
    user_choice = int(user_choice)
    correct_idx = int(correct_idx)
    
    cursor.execute('SELECT id FROM Users WHERE username = ?', (call.from_user.username,))
    user_db_id = cursor.fetchone()[0]
    
    if user_choice == correct_idx:
        bot.answer_callback_query(call.id, "✅ درسته!", show_alert=True)
        cursor.execute('UPDATE Scores SET correct = correct + 1, total = total + 1 WHERE user_id = ?', (user_db_id,))
    else:
        bot.answer_callback_query(call.id, "❌ اشتباه!", show_alert=True)
        cursor.execute('UPDATE Scores SET wrong = wrong + 1, total = total + 1 WHERE user_id = ?', (user_db_id,))
    
    conn.commit()

@bot.message_handler(func=lambda m: m.text == "🎧 تمرین صوتی وزن")
def send_voice_quiz(msg):
    cursor.execute('SELECT * FROM VoiceExercises ORDER BY RANDOM() LIMIT 1')
    ex = cursor.fetchone()
    if ex:
        ex_id, file_id, weight_text, options_json, correct_idx = ex
        options = json.loads(options_json)
        
        markup = InlineKeyboardMarkup()
        for i, opt in enumerate(options):
            callback_data = f"voice_answer:{i}:{correct_idx}:{msg.from_user.id}"
            markup.add(InlineKeyboardButton(opt, callback_data=callback_data))
        
        bot.send_voice(msg.chat.id, file_id, caption="به این وزن گوش کن و گزینه‌ی درست رو انتخاب کن 🎶", reply_markup=markup)
    else:
        bot.send_message(msg.chat.id, "هیچ تمرین صوتی در دیتابیس موجود نیست!")

@bot.callback_query_handler(func=lambda call: call.data.startswith("voice_answer"))
def check_voice_answer(call):
    _, user_choice, correct_idx, user_tg_id = call.data.split(":")
    user_choice = int(user_choice)
    correct_idx = int(correct_idx)
    
    cursor.execute('SELECT id FROM Users WHERE username = ?', (call.from_user.username,))
    user_db_id = cursor.fetchone()[0]
    
    if user_choice == correct_idx:
        bot.answer_callback_query(call.id, "✅ درسته! آفرین", show_alert=True)
        cursor.execute('UPDATE Scores SET correct = correct + 1, total = total + 1 WHERE user_id = ?', (user_db_id,))
    else:
        bot.answer_callback_query(call.id, "❌ اشتباه!", show_alert=True)
        cursor.execute('UPDATE Scores SET wrong = wrong + 1, total = total + 1 WHERE user_id = ?', (user_db_id,))
    
    conn.commit()
#اپلود فایل 
@bot.message_handler(content_types=['voice', 'audio'])
def handle_audio(msg):
    if msg.voice:
        file_id = msg.voice.file_id
    elif msg.audio:
        file_id = msg.audio.file_id
    else:
        return
    
    bot.reply_to(msg, f"file_id فایل صوتی: {file_id}")
    print(f"New file_id: {file_id}")  # این رو در کنسول می‌بینی اگر محلی اجرا کنی
    
    
@bot.message_handler(func=lambda m: m.text == "👤 حساب من")
def my_account(msg):
    cursor.execute('SELECT id FROM Users WHERE username = ?', (msg.from_user.username,))
    user_db_id = cursor.fetchone()
    if user_db_id:
        user_db_id = user_db_id[0]
        cursor.execute('SELECT correct, wrong, total FROM Scores WHERE user_id = ?', (user_db_id,))
        scores = cursor.fetchone()
        if scores:
            correct, wrong, total = scores
            bot.send_message(msg.chat.id, f"حساب شما:\nدرست: {correct}\nاشتباه: {wrong}\nمجموع: {total}")
    else:
        bot.send_message(msg.chat.id, "شما ثبت‌نام نکرده‌اید!")

@bot.message_handler(func=lambda m: m.text == "🆘 پشتیبانی")
def support(msg):
    bot.send_message(msg.chat.id, "برای پشتیبانی، با @oSAMIRo تماس بگیرید.")  # Customize

# Premium features placeholder (implement subscription check if needed)
# For now, assume free version; extend for premium
print("bot started")
bot.infinity_polling()